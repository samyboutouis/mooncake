<div class="container-fluid">
  <div class="row">
    <div class="col">
      <a href="<%= faculty_page_path %>"><button class="btn btn-dark" type="button" style= "margin: 20px 10px 5px;"> Back to Courses</button></a>
      <%= link_to "Email All", send_all_mailer_path(@course), class:"btn btn-outline-secondary allmailer" %>
      <div class="table_box">
      <% info = "" %>
      <% @course.cross_listing.each do |id| %>
          <% coursec = Course.find(id) %>
          <% info +=  " / " + coursec.department.split("-").first + " "+ coursec.course_number + " - " + coursec.section_number %>
      <% end %>
        <h1 class="title"> Course Requests for <%= @course.department.split("-").first %> <%= @course.course_number%> - <%= @course.section_number%> <%= info%> </h1> <br>
        <% if flash[:alert3] %>
        <div class="alert1", style = "color: red"><%= flash[:alert3] %></div>
        <% end %>
        <div class="table-responsive">
        <form action = "/mailselected">
            <table id="myTable" cellspacing="0" width="100%" class="display table table-striped", style="background-color:white;">
              <select name="select_action" id="selected_action" class="btn btn-secondary" onchange="SelectAction()" style="float:right; margin: 0 0 20px 0"> 
                <option value="">For Selected Requests</option>
                <option value="email">Email</option>
                <option value="accept">Accept</option>
                <option value="deny">Deny</option>
              </select>

              <br>

              
              <thead>
                <tr style="text-align: center; vertical-align: middle;">
                  <th class="no sort"> <br><%= image_tag "eye_open.png", id: "unhide",class:"eye"%></th>
                  <th> Ranking </th>
                  <% @course.questions.each do |question| %>
                    <%if question.id <= 5 or question.question_text == "Which prerequisite(s) have you satisfied:" %>
                      <th> <%= question.question_text %><br><%= image_tag "eye.png", id: "hide",class:"eye"%></th>
                    <%else%>
                      <th> <%= question.question_text %></th>
                    <%end%>
                  <% end %>
                  <th>  </th>
                  <th> Accept/Deny Request </th>
                  <th> Select </th>
                </tr>
              </thead>
              <tbody>
                  
                <% @course.course_requests.each do |request| %>
                  <tr style="text-align: center; vertical-align: middle;">
                    <td class="details-control"></td>
                    
                    <% if request.priority == nil %>
                    <td>
                    <p hidden> 3 </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "Yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "Maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "No", rank3_path(request), class:"dropdown-item" %>
                          </div>
                        </div>
                      </td>
                      <% elsif request.priority == 1 %>
                      <td>
                        <p class="yes" hidden style="color:green;"> 1 </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Yes
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "Yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "Maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "No", rank3_path(request), class:"dropdown-item" %>
                          </div>
                        </div>
                      </td>
                      <% elsif request.priority == 2 %>
                      <td>
                        <p class="maybe" hidden style="color:orange;"> 2 </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Maybe
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "Yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "Maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "No", rank3_path(request), class:"dropdown-item" %>
                          </div>
                        </div>
                      </td>
                      <% else %>
                      <td>
                        <p class="noo" hidden style="color:red;"> 4 </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            No
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "Yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "Maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "No", rank3_path(request), class:"dropdown-item" %>

                          </div>
                        </div>
                        </td>
                      <% end %>
                      
                    <% request.answers.each do |answer| %>
                      <% if answer.question.question_type == "Checkbox"%>
                        <td><%= answer.answer_text.gsub("~", ", ") %></td>
                      <% elsif answer.question.question_type == "Long Answer"%>
                        <td><div style="width:100%; max-height:200px; overflow:auto"><%= answer.answer_text %></div></td>
                      <% else %>
                        <td><%= answer.answer_text %></td>
                      <% end %>
                    <% end %>
                    <td>  <%= link_to "Send Custom Email", send_mailer_path(request) %> </td>
                    <td>
                      <% if request.status == "Under Review"%>
                        <%= link_to "Accept", accept_path(request), data: {confirm: "Are you sure you want to accept #{request.answers.first.answer_text}?"}, class:"btn btn-success btn-sm accept"%>
                        <%= link_to "Deny", deny_path(request), data: {confirm: "Are you sure you want to deny #{request.answers.first.answer_text}?"}, class:"btn btn-danger btn-sm accept"%>
                      <% elsif request.status == "Denied"%>
                        <p style="color:red;"> Denied </p>
                      <% else %>
                        <p style="color:green;"> Accepted </p>
                        <p style="color:green;"> Granted: <%= request.permission_number.number %> <br> for <%= request.course.department.split("-").first %> <%= request.course.course_number %> - <%= request.course.section_number %> <br> Expires on: <%=request.permission_number.expire_date%> </p>
                      <% end %>
                    </td>
                    <td> 
                    <input style="font-family: 'Roboto', sans-serif;font-size: 15px;" type="checkbox" name= "selected[]" id= "<%= request.id %>" value= "<%= request.id %>" id = "cb"/>
                    </td>

                  </tr>
                <% end %>


                <% @course.cross_listing.each do |id| %>
                  <% Course.find(id).course_requests.each do |request| %>
                    <tr style="text-align: center; vertical-align: middle;">
                    <td class="details-control"></td>
                    <% if request.priority == nil %>
                    <td>
                    <p hidden> 3 </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "Yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "Maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "No", rank3_path(request), class:"dropdown-item" %>
                          </div>
                        </div>
                      </td>
                      <% elsif request.priority == 1 %>
                      <td>
                        <p class="yes" hidden style="color:green;"> 1 </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Yes
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "Yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "Maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "No", rank3_path(request), class:"dropdown-item" %>
                          </div>
                        </div>
                      </td>
                      <% elsif request.priority == 2 %>
                      <td>
                        <p class="maybe" hidden style="color:orange;"> 2 </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Maybe
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "Yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "Maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "No", rank3_path(request), class:"dropdown-item" %>
                          </div>
                        </div>
                      </td>
                      <% else %>
                      <td>
                        <p class="noo" hidden style="color:red;"> 4 </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            No
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "Yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "Maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "No", rank3_path(request), class:"dropdown-item" %>

                          </div>
                        </div>
                        </td>
                      <% end %>
                    <% request.answers.each do |answer| %>
                      <% if answer.question.question_type == "Checkbox"%>
                        <td><%= answer.answer_text.gsub("~", ", ") %></td>
                      <% elsif answer.question.question_type == "Long Answer"%>
                        <td><div style="width:100%; max-height:200px; overflow:auto"><%= answer.answer_text %></div></td>
                      <% else %>
                        <td><%= answer.answer_text %></td>
                      <% end %>
                    <% end %>
                    <td>  <%= link_to "Send Custom Email", send_mailer_path(request) %> </td>
                    <td>
                      <% if request.status == "Under Review"%>
                        <%= link_to "Accept", accept_path(request), data: {confirm: "Are you sure you want to accept #{request.user.first_name}?"}, class:"btn btn-success btn-sm accept"%>
                        <%= link_to "Deny", deny_path(request), data: {confirm: "Are you sure you want to deny #{request.user.first_name}?"}, class:"btn btn-danger btn-sm accept"%>
                      <% elsif request.status == "Denied"%>
                        <p style="color:red;"> Denied </p>
                      <% else %>
                        <p style="color:green;"> Accepted </p>
                        <p style="color:green;"> Granted: <%= request.permission_number.number %> <br> for <%= request.course.department.split("-").first %> <%= request.course.course_number %> - <%= request.course.section_number %> <br> Expires on: <%=request.permission_number.expire_date%> </p>
                      <% end %>
                    </td>
                    <td> 
                    <input style="font-family: 'Roboto', sans-serif;font-size: 15px;" type="checkbox" name= "selected[]" id= "<%= request.id %>" value= "<%= request.id %>" id = "cb"/>
                    </td>

                  </tr>
                  
                  <% end %>
                <% end %>
                
                

              </tbody>
          </table>
          <input type="hidden" name="courseid" value="<%= @course.id %>">
          <br>
          <button hidden id="email" type="submit" class="btn btn-outline-secondary" style="float: right">Email Selected</button>
          <button hidden id = "accept" type="submit" class="btn btn-outline-success" formaction="/accept_selected"> Accept Selected</button>
          <button hidden id = "deny" type="submit" class="btn btn-outline-danger" formaction="/deny_selected"> Deny Selected</button>

          <script>
            function SelectAction() {
              var act = document.getElementById("selected_action").value;
              console.log(act)
              document.getElementById(act).click();
            }
          </script>
        </div>
      </div>
    </div>
  </div>
</div>
<p class="spacer"></p>
