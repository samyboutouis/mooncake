<div class="container-fluid">
  <div class="row">
    <div class="col">
      <a href="<%= faculty_page_path %>"><button class="btn btn-dark" type="button" style= "margin: 20px 10px 5px;"> Back to Courses</button></a>
      <%= link_to "Send All Mailer", send_all_mailer_path(@course), class:"btn btn-outline-secondary allmailer" %>
      <div class="table_box">
      <% info = "" %>
      <% @course.cross_listing.each do |id| %>
          <% coursec = Course.find(id) %>
          <% info +=  " / " + coursec.department.split("-").first + " "+ coursec.course_number + " - " + coursec.section_number %>
      <% end %>
        <h1 class="title"> Course Requests for <%= @course.department.split("-").first %> <%= @course.course_number%> - <%= @course.section_number%> <%= info%> </h1>
        <div class="table-responsive">
            <table id="myTable" cellspacing="0" width="100%" class="display table table-striped", style="background-color:white;">
              <thead>
                <tr style="text-align: center; vertical-align: middle;">
                  <th class="no sort"> <br><%= image_tag "eye_open.png", id: "unhide",class:"eye"%></th>
                  <th> Ranking </th>
                  <% @course.questions.each do |question| %>
                    <%if question.id <= 5 or question.question_text == "Which course(s) have you taken:" %>
                      <th> <%= question.question_text %><br><%= image_tag "eye.png", id: "hide",class:"eye"%></th>
                    <%else%>
                      <th> <%= question.question_text %></th>
                    <%end%>
                  <% end %>
                  <th>  </th>
                  <th> Accept/Deny Request </th>
                </tr>
              </thead>
              <tbody>

                <% @course.course_requests.each do |request| %>
                  <tr style="text-align: center; vertical-align: middle;">
                    <td class="details-control"></td>
                    <td>
                      <% if request.priority == nil %>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "no", rank3_path(request), class:"dropdown-item" %>
                          </div>
                        </div>
                      <% elsif request.priority == 1 %>
                        <p class="yes" hidden style="color:green;"> yes </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            yes
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "no", rank3_path(request), class:"dropdown-item" %>

                          </div>
                        </div>
                      <% elsif request.priority == 2 %>
                        <p class="maybe" hidden style="color:orange;"> maybe </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            maybe
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "no", rank3_path(request), class:"dropdown-item" %>

                          </div>
                        </div>
                      <% else %>
                        <p class="noo" hidden style="color:red;"> no </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            no
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "no", rank3_path(request), class:"dropdown-item" %>

                          </div>
                        </div>
                      <% end %>
                    </td>
                    <% request.answers.each do |answer| %>
                      <% if answer.question.question_type == "Checkbox"%>
                        <td><%= answer.answer_text.gsub("~", ", ") %></td>
                      <% elsif answer.question.question_type == "Long Answer"%>
                        <td><div style="width:100%; max-height:200px; overflow:auto"><%= answer.answer_text %></div></td>
                      <% else %>
                        <td><%= answer.answer_text %></td>
                      <% end %>
                    <% end %>
                    <td>  <%= link_to "Send Custom Email", send_mailer_path(request) %> </td>
                    <td>
                      <% if request.status == "Under Review"%>
                        <%= link_to "Accept", accept_path(request), data: {confirm: "Are you sure you want to accept #{request.answers.first.answer_text}?"}, class:"btn btn-success btn-sm accept"%>
                        <%= link_to "Deny", deny_path(request), data: {confirm: "Are you sure you want to deny #{request.answers.first.answer_text}?"}, class:"btn btn-danger btn-sm accept"%>
                      <% elsif request.status == "Denied"%>
                        <p style="color:red;"> Denied </p>
                      <% else %>
                        <p style="color:green;"> Accepted </p>
                        <p style="color:green;"> Granted: <%= request.permission_number.number %> <br> for <%= request.course.department.split("-").first %> <%= request.course.course_number %> - <%= request.course.section_number %> <br> Expires on: <%=request.permission_number.expire_date%> </p>
                      <% end %>
                    </td>

                  </tr>
                <% end %>


                <% @course.cross_listing.each do |id| %>
                  <% Course.find(id).course_requests.each do |request| %>
                    <tr style="text-align: center; vertical-align: middle;">
                    <td class="details-control"></td>
                    <td>
                      <% if request.priority == nil %>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Select
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "no", rank3_path(request), class:"dropdown-item" %>
                          </div>
                        </div>
                      <% elsif request.priority == 1 %>
                        <p class="yes" hidden style="color:green;"> yes </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            yes
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "no", rank3_path(request), class:"dropdown-item" %>

                          </div>
                        </div>
                      <% elsif request.priority == 2 %>
                        <p class="maybe" hidden style="color:orange;"> maybe </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            maybe
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "no", rank3_path(request), class:"dropdown-item" %>

                          </div>
                        </div>
                      <% else %>
                        <p class="noo" hidden style="color:red;"> no </p>
                        <div class="dropdown">
                          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            no
                          </button>
                          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <%=link_to "yes", rank1_path(request), class:"dropdown-item" %>
                            <%=link_to "maybe", rank2_path(request), class:"dropdown-item" %>
                            <%=link_to "no", rank3_path(request), class:"dropdown-item" %>

                          </div>
                        </div>
                      <% end %>
                    </td>
                    <% request.answers.each do |answer| %>
                      <% if answer.question.question_type == "Checkbox"%>
                        <td><%= answer.answer_text.gsub("~", ", ") %></td>
                      <% elsif answer.question.question_type == "Long Answer"%>
                        <td><div style="width:100%; max-height:200px; overflow:auto"><%= answer.answer_text %></div></td>
                      <% else %>
                        <td><%= answer.answer_text %></td>
                      <% end %>
                    <% end %>
                    <td>  <%= link_to "Send Custom Email", send_mailer_path(request) %> </td>
                    <td>
                      <% if request.status == "Under Review"%>
                        <%= link_to "Accept", accept_path(request), data: {confirm: "Are you sure you want to accept #{request.user.first_name}?"}, class:"btn btn-success btn-sm accept"%>
                        <%= link_to "Deny", deny_path(request), data: {confirm: "Are you sure you want to deny #{request.user.first_name}?"}, class:"btn btn-danger btn-sm accept"%>
                      <% elsif request.status == "Denied"%>
                        <p style="color:red;"> Denied </p>
                      <% else %>
                        <p style="color:green;"> Accepted </p>
                        <p style="color:green;"> Granted: <%= request.permission_number.number %> <br> for <%= request.course.department.split("-").first %> <%= request.course.course_number %> - <%= request.course.section_number %> <br> Expires on: <%=request.permission_number.expire_date%> </p>
                      <% end %>
                    </td>

                  </tr>
                  <% end %>
                <% end %>


              </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<p class="spacer"></p>
